// Generated by CoffeeScript 1.3.3
var VideoFoam,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

VideoFoam = (function() {

  function VideoFoam() {
    this.updateOutput = __bind(this.updateOutput, this);

    this.debounceUpdateOutput = __bind(this.debounceUpdateOutput, this);

    var _this = this;
    this.resizeable = false;
    this.iframeApiString = "\n<script src='//fast.wistia.com/static/iframe-api-v1.js'></script>";
    $("#configure").on("keyup", "input[type=text], textarea", function() {
      return _this.debounceUpdateOutput();
    });
  }

  VideoFoam.prototype.debounceUpdateOutput = function() {
    var updateOutputTimeout;
    clearTimeout("updateOutputTimeout");
    return updateOutputTimeout = setTimeout(this.updateOutput, 500);
  };

  VideoFoam.prototype.updateOutput = function() {
    var isIframe, isPopover;
    this.sourceEmbedCode = Wistia.EmbedCode.parse($("#source_embed_code").val());
    this.outputEmbedCode = Wistia.EmbedCode.parse($("#source_embed_code").val());
    if (this.sourceEmbedCode && this.sourceEmbedCode.isValid()) {
      isIframe = Wistia.EmbedCode.isIframe(this.sourceEmbedCode);
      isPopover = Wistia.EmbedCode.isPopover(this.sourceEmbedCode);
      this.outputEmbedCode.setOption("videoFoam", true);
      if (isIframe || isPopover) {
        this.outputEmbedCode = this.outputEmbedCode.toString() + this.iframeApiString;
        $("#output_embed_code").val(this.outputEmbedCode);
      } else {
        $("#output_embed_code").val(this.outputEmbedCode);
      }
      this.outputEmbedCode.previewInElem("preview");
      $("#try").show();
      if (!this.resizeable) {
        this.addResizableTo($("#draggable_wrapper"));
        return this.resizeable = true;
      }
    } else {
      $("#output_embed_code").val("Hmm, that embed code doesn't look right. Maybe our dog chewed on it?");
      return $("#preview").html('<div id="placeholder_preview">Your video here</div>');
    }
  };

  VideoFoam.prototype.addResizableTo = function(elem) {
    return elem.addClass('foamed').draggable().resizable();
  };

  return VideoFoam;

})();

window.setupLabInterface = function($) {
  return $(function() {
    return window.VideoFoam = new VideoFoam();
  });
};
